<!DOCTYPE html>
<html lang="ru" data-theme="minimal">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MeowMap</title>
  <link rel="icon" href="assets/Group 68.svg" type="image/svg+xml">

  <!-- Подключаем стили MapLibre и тему -->
  <link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet">
  <link href="assets/css/theme.css" rel="stylesheet">

  <style>
    html, body { height: 100%; }
    :root {
      --font-size-base: 16px;
      --font-size-large: calc(var(--font-size-base) * 1.1); /* +10% */
    }
    body {
      margin: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
      height: 100svh;
      height: 100dvh;
      background: var(--surface-0);
      color: var(--text-0);
      font-family: var(--font-ui);
      /* Безопасные зоны для современных устройств */
      padding-top: env(safe-area-inset-top);
      padding-left: env(safe-area-inset-left);
      padding-right: env(safe-area-inset-right);
    }
    #controls {
      display: flex;
      align-items: center;
      gap: 8px; /* Единый gap между всеми элементами */
      flex-wrap: wrap;
      padding: 12px;
      padding-top: calc(12px + env(safe-area-inset-top));
      padding-left: calc(12px + env(safe-area-inset-left));
      padding-right: calc(12px + env(safe-area-inset-right));
      background: var(--surface-1);
      border-bottom: var(--border);
      position: relative;
      height: 90px; /* 29px + padding */
      min-height: 90px;
      max-height: 90px;
      box-sizing: border-box;
    }
    #layout { flex: 1; display: flex; }
    #map { flex: 1; width: 100%; height: 100%; }
    .date-input-container {
      display: flex;
      flex-direction: column;
      gap: 4px;
      flex: 0 0 160px;
      margin-left: 0;
      margin-right: 0;
      padding-left: 12px; /* Единый отступ слева */
      justify-content: center;
    }

    .date-input-container label {
      font-size: 12px;
      color: var(--text-1);
      font-weight: 500;
      text-align: left;
      margin: 0;
      order: -1;
    }

    input[type="date"] {
      background:#d2cde7;
      color:var(--text-0);
      border:none;
      border-radius:9999px;
      padding:.5rem .75rem;
      accent-color: var(--brand);
      color-scheme: light;
      font-family:var(--font-ui);
      font-size: calc(var(--control-height) * 0.4);
      font-weight:600;
      cursor:pointer;
      transition: all var(--fx-fast);
      box-shadow: var(--shadow-sm);
      height: var(--control-height);
      min-width: 120px;
      box-sizing: border-box;
      /* Центрируем текст даты для всех адаптивов */
      text-align: center;
      /* Полностью отключаем системный календарь браузера */
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      outline: none;
    }
    input[type="date"]:hover {
      background: color-mix(in srgb, #d2cde7 90%, transparent);
    }
    input[type="date"]:focus {
      outline:3px solid color-mix(in srgb, var(--brand) 55%, transparent);
      outline-offset:2px;
      background: color-mix(in srgb, #d2cde7 90%, transparent);
    }
    /* Скрываем стрелку календаря в Firefox */
    input[type="date"]::-webkit-calendar-picker-indicator {
      display: none;
    }
    input[type="date"]::-moz-focus-inner {
      border: 0;
      padding: 0;
    }
    /* Центрируем текстовые поля даты для WebKit (Chrome, Safari) и Firefox */
    input[type="date"]::-webkit-datetime-edit {
      text-align: center;
    }
    input[type="date"]::-webkit-datetime-edit-fields-wrapper {
      text-align: center;
    }
    input[type="date"]::-webkit-datetime-edit-day-field,
    input[type="date"]::-webkit-datetime-edit-month-field,
    input[type="date"]::-webkit-datetime-edit-year-field {
      text-align: center;
    }
    input[type="date"]::-moz-date-input {
      text-align: center;
    }
    #logo {
      height: var(--control-height);
      min-width: var(--control-height);
      display: flex;
      align-items: center;
      padding: 0;
      border-radius: var(--radius-xs);
      transition: background var(--fx-fast);
      box-sizing: border-box;
    }
    #logo:hover { background: var(--surface-2); }
    #help, #burger {
      width: var(--control-height);
      height: var(--control-height);
      min-width: var(--control-height);
      min-height: var(--control-height);
      max-width: var(--control-height);
      max-height: var(--control-height);
      font-size: calc(var(--control-height) * 0.5);
      padding: 0;
      border-radius: 9999px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--surface-1);
      transition: background var(--fx-fast);
      box-sizing: border-box;
      line-height: var(--control-height);
    }
    #help:hover, #burger:hover { background: var(--surface-2); }
    #help:focus-visible, #burger:focus-visible { outline: 3px solid color-mix(in srgb, var(--brand) 55%, transparent); outline-offset: 2px; }
    .header-buttons { display: flex; gap: 8px; margin-left: auto; }
    #help {
      cursor: pointer;
      font-weight: 700;
      color: var(--text-0);
      user-select: none;
      position: relative;
      z-index: 1300;
      background: var(--surface-1);
      padding: 0;
      border-radius:50%;
      transition: background var(--fx-fast);
      min-height: var(--control-height);
      min-width: var(--control-height);
      display: flex;
      align-items: center;
      justify-content: center;
      box-sizing: border-box;
      line-height: var(--control-height);
    }
    #help:hover { background: var(--surface-2); }
    #help:focus-visible { outline: 3px solid color-mix(in srgb, var(--brand) 55%, transparent); outline-offset: 2px; }
    #burger {
      cursor: pointer;
      font-weight: 700;
      color: var(--text-0);
      user-select: none;
      position: relative;
      z-index: 1300;
      background: var(--surface-1);
      padding: 0;
      border-radius:50%;
      transition: background var(--fx-fast);
      min-height: var(--control-height);
      min-width: var(--control-height);
      display: flex;
      align-items: center;
      justify-content: center;
      box-sizing: border-box;
      line-height: var(--control-height);
    }
    #burger:hover { background: var(--surface-2); }
    #burger:focus-visible { outline: 3px solid color-mix(in srgb, var(--brand) 55%, transparent); outline-offset: 2px; }

    /* Сайдбар со списком событий */
    #sidebar {
      position: fixed;
      right: 0;
      top: 0;
      bottom: 90px;
      width: 320px;
      background: var(--surface-1);
      border-left: var(--border);
      border-top: var(--border);
      border-bottom: var(--border);
      border-top-left-radius: var(--radius-md);
      border-bottom-left-radius: var(--radius-md);
      box-shadow: var(--shadow-sm);
      font-size: var(--font-size-base);
      overflow: hidden;
      transform: translateX(100%);
      transition: transform .3s;
      z-index: 1200;
    }
    .sidebar-content {
      position: relative;
      top: 89px;
      height: calc(100% - 89px);
      overflow-y: auto;
      padding-top: 1px;
      padding-left: 12px;
      padding-right: 12px;
      padding-bottom: 0;
    }
    #sidebar.open { transform: translateX(0); }
    #sidebar .item {
      margin-bottom: 12px;
      cursor: pointer;
      padding: 8px;
      border-bottom: var(--border);
      border-radius: var(--radius-sm);
      transition: background var(--fx-fast), transform var(--fx-fast);
    }
    #sidebar .item:hover { background: var(--surface-2); }
    #sidebar .item.is-active { outline: 2px solid color-mix(in srgb, var(--brand) 55%, transparent); border-radius: var(--radius-sm); }
    #sidebar hr {
      margin-top: 50px;
      margin-bottom: 12px;
    }


    :root { --search-panel-offset: 0px; }
    #bottomBar {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 900;
      background: var(--surface-1);
      border-top: var(--border);
      box-shadow: 0 -12px 30px rgba(15, 18, 36, 0.1);
      padding: 12px 12px calc(12px + env(safe-area-inset-bottom));
      display: flex;
      justify-content: flex-start;
      height: 90px;
      box-sizing: border-box;
    }
    #bottomBar .bottom-bar__inner {
      width: min(680px, 100%);
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .search-field {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 10px;
      background: var(--surface-0);
      border: var(--border);
      border-radius:9999px;
      padding: 10px 14px;
      box-shadow: var(--shadow-sm);
      transition: box-shadow var(--fx-fast), border-color var(--fx-fast);
    }
    .search-field:focus-within {
      box-shadow: var(--shadow-md);
      border-color: color-mix(in srgb, var(--brand) 55%, transparent);
    }
    .search-field__icon {
      color: var(--text-1);
      font-size: var(--font-size-large);
      display: inline-flex;
    }
    #global-search {
      flex: 1;
      border: none;
      background: transparent;
      color: var(--text-0);
      font-size: var(--font-size-base);
      font-family: inherit;
      min-width: 0;
      outline: none;
    }
    #global-search::placeholder { color: var(--text-1); }
    /* Отключаем браузерные украшения для поля поиска */
    #global-search::-webkit-search-decoration,
    #global-search::-webkit-search-cancel-button,
    #global-search::-webkit-search-results-button,
    #global-search::-webkit-search-results-decoration {
      -webkit-appearance: none;
      appearance: none;
    }
    #search-clear {
      border: none;
      background: transparent;
      color: var(--text-1);
      font-size: var(--font-size-large);
      cursor: pointer;
      display: none;
      padding: 2px;
      line-height: 1;
    }
    #search-clear.is-visible { display: inline-flex; }
    /* Скрываем пользовательский крестик */
    #search-clear { display: none !important; }

    #search-panel {
      position: fixed;
      left: 0;
      right: 0;
      bottom: var(--search-panel-offset);
      background: var(--surface-1);
      border-top: var(--border);
      box-shadow: 0 -18px 38px rgba(15, 18, 36, 0.18);
      border-top-left-radius: var(--radius-md);
      border-top-right-radius: var(--radius-md);
      padding: 12px 16px 16px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: min(70dvh, 520px);
      transform: translateY(calc(100% + 32px));
      opacity: 0;
      pointer-events: none;
      transition: transform var(--fx-slow), opacity var(--fx-fast);
      z-index: 950;
      touch-action: pan-y;
    }
    #search-panel.open {
      transform: translateY(0);
      opacity: 1;
      pointer-events: auto;
    }
    .search-panel__handle {
      width: 46px;
      height: 5px;
      border-radius: 999px;
      background: color-mix(in srgb, var(--text-1) 25%, transparent);
      align-self: center;
      cursor: grab;
    }
    .search-panel__label {
      margin: 4px 0 0;
      font-size: 0.8rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--text-1);
    }
    #search-results {
      margin: 0;
      padding: 0;
      list-style: none;
      overflow-y: auto;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    #search-results li {
      padding: 10px 12px;
      border-radius: var(--radius-sm);
      background: transparent;
      cursor: pointer;
      transition: background var(--fx-fast);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    #search-results li:hover { background: var(--surface-2); }
    #search-results li:focus-visible {
      outline: 3px solid color-mix(in srgb, var(--brand) 55%, transparent);
      outline-offset: 2px;
    }
    #search-results li strong { color: var(--text-0); font-size: calc(0.95rem * 1.1); }
    #search-results li span { color: var(--text-1); font-size: calc(0.85rem * 1.1); }
    .search-panel__empty {
      margin: 0;
      padding: 12px;
      text-align: center;
      color: var(--text-1);
      border-radius: var(--radius-sm);
      background: var(--surface-2);
    }

    /* Медиа-запросы для мобильных устройств */
    @media (max-width: 768px) {
      :root { --control-height: 44px; }
      #layout { flex-direction: column; }
      #sidebar { width: 80%; max-width: 320px; }
      #sidebar hr { margin-top: 45px; }
      #bottomBar { padding: 10px 12px calc(10px + env(safe-area-inset-bottom)); }
      .search-field { padding: 8px 12px; }
      #global-search { font-size: 15px; }
      .welcome-modal__content {
        top: calc(90px + 2.5vw);
        bottom: calc(90px + 2.5vw + 30px);
        left: 50%;
        transform: translateX(-50%);
        height: auto;
        max-height: calc(100vh - 180px - 5vw - 30px);
      }
    }

    /* Планшеты и большие телефоны */
    @media (max-width: 640px) {
      :root { --control-height: 40px; }
      #controls {
        gap: 6px;
        padding: 10px 8px;
      }
      .date-input-container { flex: 0 0 140px; }
      input[type="date"] { font-size: 14px; min-width: 140px; }
      .date-input-container label { font-size: 11px; }
      #burger { font-size: 20px; }
      #sidebar hr { margin-top: 40px; }
      .welcome-modal {
        top: env(safe-area-inset-top);
        left: env(safe-area-inset-left);
        width: calc(100vw - env(safe-area-inset-left) - env(safe-area-inset-right));
        height: calc(100vh - env(safe-area-inset-top) - env(safe-area-inset-bottom));
        box-sizing: border-box;
      }
    }

    /* Стандартные мобильные телефоны */
    @media (max-width: 480px) {
      :root { --control-height: 36px; }
      #controls {
        gap: 2px;
        padding: 6px 4px;
        flex-wrap: nowrap;
      }
      .date-input-container { flex: 0 1 auto; min-width: 80px; max-width: 90px; margin-right: 20px; }
      input[type="date"] { font-size: 12px; min-width: auto; width: 100%; }
      .date-input-container label { font-size: 9px; }
      #help { padding: 6px; }
      #burger { padding: 6px; }
      #sidebar hr { margin-top: 35px; }
    }

    /* Узкие экраны (iPhone SE, старые устройства) */
    @media (max-width: 375px) {
      :root { --control-height: 32px; }
      #controls {
        gap: 2px;
        padding: 6px 4px;
        justify-content: space-between;
      }
      .date-input-container { flex: 1; max-width: 120px; min-width: 70px; }
      input[type="date"] { font-size: 12px; min-width: auto; width: 100%; }
      .date-input-container label { font-size: 9px; }
      #help { padding: 4px; }
      #burger { padding: 4px; }
      #sidebar hr { margin-top: 30px; }
    }

    /* Критически узкие экраны */
    @media (max-width: 320px) {
      :root { --control-height: 20px; }
      #controls {
        flex-direction: column;
        align-items: stretch;
        gap: 4px;
      }
      #logo {
        align-self: center;
        order: -1;
      }
      .date-input-container {
        flex: 1;
        align-self: stretch;
      }
      input[type="date"] {
        font-size: 12px;
        min-width: unset;
      }
      .date-input-container label {
        font-size: 9px;
      }
      #burger {
        align-self: flex-end;
        padding: 2px;
      }
      #sidebar hr { margin-top: 25px; }
    }
    /* Переопределение фона футера сайдбара для всех тем */
    .sidebar-footer {
      position: absolute;
      bottom: 15px;
      right: 15px;
      background: transparent !important;
      z-index: 1300;
    }
    #toggleArchive {
      display:inline-flex; align-items:center; gap:.5rem; padding:7px 11px;
      border:none; border-radius:9999px;
      background: var(--surface-1);
      color: var(--text-0);
      font-size:12px; font-weight:500; font-family: var(--font-ui);
      cursor:pointer; user-select:none;
      transition: background var(--fx-fast);
      box-shadow: var(--shadow-sm);
      outline: none;
      -webkit-tap-highlight-color: transparent;
    }
    #toggleArchive:hover { background: var(--surface-2); }
    #copy-toast {
      position: fixed;
      left: 16px;
      bottom: calc(56px + 24px + env(safe-area-inset-bottom)); /* 24px — небольшой отступ */
      transform: translate(0, 16px);
      background: var(--surface-1);
      border: var(--border);
      border-radius: var(--radius-sm);
      padding: 8px 14px;
      font-size: var(--font-size-base);
      color: var(--text-0);
      box-shadow: var(--shadow-md);
      opacity: 0;
      pointer-events: none;
      transition: opacity var(--fx-fast), transform var(--fx-fast);
      z-index: 1300;
    }
    #copy-toast.is-visible {
      opacity: 1;
      transform: translate(0, 0);
    }
    .welcome-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 2000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.15s ease-in-out;
    }
    .welcome-modal.show {
      opacity: 1;
      pointer-events: auto;
    }
    .welcome-modal__backdrop {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.3);
      backdrop-filter: blur(5px);
      opacity: 0;
      transition: opacity 0.25s ease-in-out;
    }
    .welcome-modal.show .welcome-modal__backdrop {
      opacity: 1;
    }
    .welcome-modal__content {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      background: var(--surface-1);
      color: var(--text-0);
      padding: 32px;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
      max-width: 600px;
      width: 95vw;
      height: 450px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      box-sizing: border-box;
    }
    .welcome-modal__content > * {
      transition: opacity 0.15s ease-in-out;
    }
    .welcome-modal.show .welcome-modal__content {
      opacity: 1;
    }
    .welcome-btn {
      background: #d2cde7;
      color: var(--text-0);
      border: none;
      border-radius: 9999px;
      padding: 12px 16px;
      font-family: var(--font-ui);
      font-size: 18px;
      font-weight: 500;
      cursor: pointer;
      transition: background var(--fx-fast);
      margin: 4px;
      display: inline-block;
    }
    .welcome-btn:hover {
      background: color-mix(in srgb, #d2cde7 90%, transparent);
    }
    .welcome-buttons {
      display: flex;
      justify-content: center;
      flex-wrap: nowrap;
      gap: 8px;
      margin-top: 16px;
    }
    .welcome-modal h1, .welcome-modal h2 {
      margin: 0 0 16px;
      font-weight: 600;
    }
    .welcome-modal p {
      margin: 16px 0;
      line-height: 1.6;
      font-size: 20px;
      text-align: center;
    }
    .welcome-logo {
      margin: 0 auto 16px;
      display: block;
      width: 60px;
      height: 60px;
    }
    .inline-logo {
      height: 2em;
      vertical-align: baseline;
      margin: 0 2px;
    }

    /* Адаптив для приветственного экрана */
    @media (max-width: 768px) {
      .welcome-modal__content {
        padding: 24px;
        height: 400px;
      }
      .welcome-logo {
        width: 55px;
        height: 55px;
      }
      .welcome-modal p {
        font-size: 18px;
      }
      .welcome-btn {
        padding: 10px 14px;
        font-size: 16px;
      }
    }

    @media (max-width: 640px) {
      .welcome-modal__content {
        padding: 20px;
        left: 10vw;
        width: 80vw;
        height: auto;
        top: calc(90px + 10vw);
        bottom: calc(90px + 10vw + 30px);
        transform: none;
        max-height: calc(100vh - 180px - 20vw - 30px);
      }
      .welcome-logo {
        width: 50px;
        height: 50px;
      }
      .welcome-modal p {
        font-size: 17px;
      }
      .welcome-btn {
        padding: 8px 12px;
        font-size: 15px;
      }
    }

    @media (max-width: 480px) {
      .welcome-modal__content {
        padding: 16px;
        height: auto;
        top: calc(90px + 2.5vw + env(safe-area-inset-top));
        bottom: calc(90px + 2.5vw + 30px);
        left: 50%;
        transform: translateX(-50%);
        max-height: calc(100vh - 180px - 5vw - 30px);
      }
      .welcome-logo {
        width: 45px;
        height: 45px;
        margin-bottom: 12px;
      }
      .welcome-modal p {
        font-size: 16px;
      }
      .welcome-btn {
        padding: 6px 10px;
        font-size: 13px;
      }
    }

    @media (max-width: 375px) {
      .welcome-modal__content {
        padding: 12px;
        height: auto;
        top: calc(90px + 10vw);
        bottom: calc(90px + 10vw + 30px);
        left: calc(10vw + env(safe-area-inset-left));
        right: calc(10vw + env(safe-area-inset-right));
        transform: none;
        max-height: calc(100vh - 180px - 20vw - 30px);
      }
      .welcome-logo {
        width: 40px;
        height: 40px;
        margin-bottom: 8px;
      }
      .welcome-modal p {
        font-size: 14px;
        margin: 12px 0;
      }
      .welcome-buttons {
        gap: 4px;
      }
      .welcome-btn {
        padding: 4px 8px;
        font-size: 12px;
        margin: 2px;
      }
    }
  </style>
</head>
<body>
  <div id="controls">
    <div class="date-input-container">
      <input type="date" id="event-date">
    </div>
    <img id="logo" src="assets/Vector.png" alt="Meow Records">
    <div class="header-buttons">
      <span id="help" aria-label="Открыть приветственный экран" role="button" tabindex="0">?</span>
      <span id="burger" aria-label="Открыть список событий" role="button" tabindex="0">☰</span>
    </div>
  </div>

  <div id="layout">
    <div id="map" role="application" aria-label="Карта событий"></div>
  </div>

  <aside id="sidebar" aria-label="Список событий">
    <div class="sidebar-footer">
      <button id="toggleArchive" type="button">Архив</button>
    </div>
    <div class="sidebar-content">
      <div class="sidebar-header" style="display:flex;justify-content:space-between;align-items:center;">
        <h3 style="margin:0;">События</h3>
      </div>
      <div id="upcoming"></div>
    </div>
  </aside>

  <div id="bottomBar" role="search">
    <div class="bottom-bar__inner">
      <div class="search-field">
        <span class="search-field__icon" aria-hidden="true">🔍</span>
        <input type="search" id="global-search" placeholder="Поиск событий и мест" autocomplete="off" enterkeyhint="search" aria-label="Поиск событий и мест">
        <button type="button" id="search-clear" aria-label="Очистить поиск">×</button>
      </div>
    </div>
  </div>

  <section id="search-panel" aria-hidden="true" role="dialog" aria-label="Результаты поиска">
    <div class="search-panel__handle" aria-hidden="true"></div>
    <p id="search-label" class="search-panel__label">Подсказки</p>
    <ul id="search-results" role="listbox" aria-label="Результаты поиска"></ul>
    <p id="search-empty" class="search-panel__empty">Загрузка данных…</p>
  </section>

  <!-- Скрипты -->
  <script defer src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
  <script defer src="script.js"></script>
  <script defer src="assets/js/theme.js"></script>
  <!-- Календарь -->
  <div id="calendar-modal" class="calendar-modal" role="dialog" aria-modal="true" aria-labelledby="calendar-title" hidden>
    <div class="calendar-modal__backdrop" aria-hidden="true"></div>
    <div class="calendar-modal__content">
      <div class="calendar">
        <div class="calendar__header">
          <button id="calendar-prev" class="calendar__nav calendar__nav--prev" aria-label="Предыдущий месяц">‹</button>
          <div class="calendar__month-year"></div>
          <button id="calendar-next" class="calendar__nav calendar__nav--next" aria-label="Следующий месяц">›</button>
        </div>
        <div class="calendar__weekdays">
          <div class="calendar__weekday">Пн</div>
          <div class="calendar__weekday">Вт</div>
          <div class="calendar__weekday">Ср</div>
          <div class="calendar__weekday">Чт</div>
          <div class="calendar__weekday">Пт</div>
          <div class="calendar__weekday">Сб</div>
          <div class="calendar__weekday">Вс</div>
        </div>
        <div class="calendar__days"></div>
      </div>
    </div>
  </div>

  <div id="copy-toast" role="status" aria-live="polite" hidden>Ссылка скопирована</div>

  <!-- Welcome Modal -->
  <div id="welcome-modal" class="welcome-modal" role="dialog" aria-modal="true" aria-labelledby="welcome-title" hidden>
    <div class="welcome-modal__backdrop"></div>
    <div class="welcome-modal__content" id="welcome-content"></div>
  </div>

</body>
</html>
